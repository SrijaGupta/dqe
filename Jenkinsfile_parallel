#!/usr/bin/env groovy

pipeline {
    agent any
    // options {
    //     skipDefaultCheckout true
    // }
    stages {
        stage('Groups') {
            steps {
                script {
                    def stepsForParallel = [:]
                    def branches = [:]
                    def groups = ""
                    groups = sh(returnStdout: true, script: 'echo ACX2020 MX920 SRX3200')
                    branches = groups.split()

                    // echo "groups: ${groups}"
                    // echo "branches: ${branches}"
                    
                    // println groups.getClass()
                    // println branches.getClass()

                    branches.each {
                        def stepName = "${it}"
                        stepsForParallel[stepName] = { ->           
                            sh "echo ansible-playbook -i host ${it}"
                        }
                    }
                    parallel stepsForParallel
                }
            }
        }
    }
}
